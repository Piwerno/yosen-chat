<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Yosen ðŸ’¬</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="chat">
    <h1>
        Yosen ðŸ’¬
        <button id="mainMenuBtn">â˜°</button>
    </h1>

    <div id="mainMenu" class="main-menu">
        <button onclick="supprimerTousMessages()">Supprimer tous les messages</button>
        <button onclick="changerTheme()">Changer le thÃ¨me</button>
        <button onclick="afficherAide()">Aide</button>
    </div>

    <div id="messages"></div>

    <div class="input-zone">
        <input id="messageInput" type="text" placeholder="Ton message">
        <button onclick="envoyerMessage()">Envoyer</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// VÃ©rifier si un pseudo est dÃ©jÃ  enregistrÃ©
let pseudoUtilisateur = localStorage.getItem("pseudoUtilisateur") || "";

// Si pas encore de pseudo, demander une fois
if (!pseudoUtilisateur) {
    pseudoUtilisateur = prompt("Choisis ton pseudo :") || "Utilisateur" + Math.floor(Math.random()*1000);
    localStorage.setItem("pseudoUtilisateur", pseudoUtilisateur);
}

// Couleurs pour pseudo
const colors = {};
const palette = ["#4f46e5", "#f59e0b", "#10b981", "#ef4444", "#8b5cf6"];
function getColor(pseudo) {
    if (!colors[pseudo]) colors[pseudo] = palette[Math.floor(Math.random()*palette.length)];
    return colors[pseudo];
}

// Affichage des messages
function afficherMessage({ pseudo, texte, heure }) {
    const messages = document.getElementById("messages");
    const div = document.createElement("div");
    div.className = "message";

    if (pseudo === pseudoUtilisateur) {
        div.classList.add("droite");
    } else {
        div.classList.add("gauche");
        div.style.background = getColor(pseudo);
    }

    div.innerHTML = `<strong>${pseudo}</strong> <small>(${heure})</small><br>${texte}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

// Envoyer un message
function envoyerMessage() {
    const texte = document.getElementById("messageInput").value.trim();
    if (!texte) return;

    const now = new Date();
    const heure = now.getHours().toString().padStart(2,"0") + ":" +
                  now.getMinutes().toString().padStart(2,"0");

    socket.emit("message", { pseudo: pseudoUtilisateur, texte, heure });
    document.getElementById("messageInput").value = "";
}

// Recevoir messages
socket.on("message", msg => afficherMessage(msg));

// Envoyer avec Enter
document.getElementById("messageInput").addEventListener("keypress", e => {
    if (e.key === "Enter") envoyerMessage();
});

// Menu principal
document.getElementById("mainMenuBtn").onclick = () => {
    const menu = document.getElementById("mainMenu");
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
};

// Fonctions menu
function supprimerTousMessages() { document.getElementById("messages").innerHTML = ""; }
function changerTheme() { document.body.classList.toggle("dark"); }
function afficherAide() { alert("ðŸ’¬ Chat temps rÃ©el Node.js\nCrÃ©Ã© par toi ðŸ˜Ž"); }
</script>
</body>
</html>
